{% extends "worklog/base.html" %} {% load dajaxice_templatetags %} {% block content %} {% dajaxice_js_import %}

<h2>New Work Item</h2>
{% if holidays %}
<h3>Today is a holiday. Work item hours will not count towards timesheet.</h3>
{% endif %} {% if form %}
<h4>For: {{ date|date:"DATE_FORMAT" }}</h4>

{% if reminder_id %}
<form action="/worklog/add/reminder_{{reminder_id}}/" method="post">
    {% else %}
    <form action="/worklog/add/" method="post" role="form" class="form-inline">
        {% endif %}
        <table class='table'>
            {% csrf_token %} {{ form.as_table }}
            <tr>
                <td>
                    <button class='btn btn-primary' type="submit" name="submit_and_exit">Submit and Exit</button>
                </td>
                <td>
                    <button class='btn btn-warning' type="submit" name="submit_and_add_another">Submit and Add Another</button>
                </td>
            </tr>
        </table>
    </form>

    <h4>Other Work Items Submitted on {{ date|date:"DATE_FORMAT" }}:</h4>
    <table class="table table-striped">
        <tr>
            {% for title in column_names %}
            <th>{{ title }}</th>
            {% endfor %}
        </tr>

        {% for item in items %}
        <tr>
            {% for field in item %}
            <td>{{ field }}</td>
            {% endfor %}
        </tr>
        {% endfor %}
    </table>

    {% else %}
    <p>This application is broken somehow...</p>
    {% endif %}

    <script>
    $(document).ready(function() {
        $(document).on('change', '#id_repo', function() {
            if ($(this).val() != '') {
                Dajaxice.worklog.update_repo_issues(Dajax.process, {
                    'repo_id': $(this).val()
                });
            } else {
                Dajaxice.worklog.initialize_issues(Dajax.process);
            }
        });
    });
    </script>

    {% endblock %}
